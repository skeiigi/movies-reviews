<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Мои статьи</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'moviesApp/css/styles.css' %}">
</head>
<body>
<h1>Статьи {{ user.username }}</h1>
<a href="{% url 'reviews' %}">Все обсуждения</a>

{% if reviews %}
<table>
  <thead>
    <tr>
      <th>Тема</th>
      <th>Фильм</th>
      <th>Контент</th>
    </tr>
  </thead>
  <tbody>

{% for rv in reviews %}
    <tr>
        <td>{{rv.title}}</td>
        <td>
        {% if rv.movie %}
          {% if rv.movie.poster %}
              <div style="display: flex; align-items: center;">
                <img src="{{ rv.movie.poster.url }}" alt="{{ rv.movie.title }}" style="width: 100px; height: auto; margin-right: 10px;">
                <span>{{ rv.movie.title }}</span>
              </div>
          {% else %}
            <span>(Постер к фильму не найден)</span>
          {% endif %}
        {% else %}
          <span>(Фильм не указан)</span>
        {% endif %}
      </td>
      <td>{{rv.content}}</td>
      <td><button type="submit"
                  class="edit__button"
                  data-id="{{ rv.id }}"
                  data-title="{{ rv.title }}"
                  data-movie="{{ rv.movie }}"
                  data-content="{{ rv.content }}">
          Изменить</button>
      </td>
      <td>
          <form method="post" action="{% url 'delete_review' rv.id %}" style="display: inline;">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger"
                    onclick="return confirm('Вы уверены, что хотите удалить статью {{ rv.title }}?');">
                Удалить
            </button>
          </form>
      </td>
    </tr>
{% endfor %}

  </tbody>
</table>

{% else %}
<h1>Пока нет обсуждений...</h1>
{% endif %}

<div class="modal">
    <div class="modal__main">
        <h2 class="modal__title">Редактирование статьи</h2>
        <div class="modal__container">
            <form method="POST">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit">Сохранить</button>
            </form>

        </div>
        <button class="modal__close">&#10006;</button>
    </div>
</div>

<script>
    // Выбираем все кнопки с классом edit__button
    const buttonElems = document.querySelectorAll('.edit__button');
    const modalElem = document.querySelector('.modal');

    // Настройка стилей модального окна
    modalElem.style.cssText = `
    display: flex;
    visibility: hidden;
    opacity: 0;
    transition: opacity 300ms ease-in-out;
`;

    // Функция закрытия модального окна
    const closeModal = (event) => {
        const target = event.target;

        if (target.closest('.modal__close')) {

            modalElem.style.opacity = 0;

            setTimeout(() => {
                modalElem.style.visibility = 'hidden';
            }, 300)
        }
    };

    // Функция открытия модального окна
    const openModal = () => {
        modalElem.style.visibility = 'visible';
        modalElem.style.opacity = 1;
    };

    // Добавляем обработчик события на каждую кнопку
    buttonElems.forEach(button => {
        button.addEventListener('click', openModal);
    });

    // Добавляем обработчик события на модальное окно для закрытия
    modalElem.addEventListener('click', closeModal);
</script>
</body>
</html>